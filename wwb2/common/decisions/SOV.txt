### #  # ###  #  #  ### ### ###  #   #    ###  #### #     ##   ##   ##  ### ###  ##  #  #
 #  ## # #  # #  # #     #  #  #  # #     #  # #    #    #  # #  # #  #  #   #  #  # ## #
 #  # ## #  # #  #   #   #  ###    #      ###  ##   #    #  # #    ####  #   #  #  # # ##
 #  #  # #  # #  #    #  #  #  #   #      #  # #    #    #  # #  # #  #  #   #  #  # #  #
### #  # ###   ##  ###   #  #  #   #      #  # #### ####  ##   ##  #  #  #  ###  ##  #  #

#Category only allowed for SOV
SOV_industry_relocation = {

	SOV_relocate_industry_from_moscow = {

		icon = generic_construction

		highlight_states = {
			state = 219
		}	

		available = {
			219 = { #Moscow
				is_owned_and_controlled_by = SOV
				arms_factory > 5
				industrial_complex > 1
			} 
			573 = { is_owned_and_controlled_by = SOV } #Zlatoust
			582 = { is_owned_and_controlled_by = SOV } #Magnitogorsk
		}

		fire_only_once = yes

		cost = 25
		days_remove = 15

		modifier = {
			
		}

		visible = {
			has_war_with = GER
		}

		remove_effect = {
			if = {
				limit = {
					controls_state = 219
				}
				219 = { #Moscow
					remove_building = {
						type = arms_factory
						level = 6
					}
					remove_building = {
						type = industrial_complex
						level = 6
					}
				}
				573 = { #Zlatoust
					add_extra_state_shared_building_slots = 6
					add_building_construction = {
						type = arms_factory
						level = 3
						instant_build = yes
					}
					add_building_construction = {
						type = industrial_complex
						level = 3
						instant_build = yes
					}
	
					hidden_effect = {
						damage_building = { type = arms_factory damage = 0.1 }
						damage_building = { type = industrial_complex damage = 0.1 }
					}
				}
				582 = { #Magnitogorsk
					add_extra_state_shared_building_slots = 6
					add_building_construction = {
						type = arms_factory
						level = 3
						instant_build = yes
					}
					add_building_construction = {
						type = industrial_complex
						level = 3
						instant_build = yes
					}
				
					hidden_effect = {
						damage_building = { type = arms_factory damage = 0.1 }
						damage_building = { type = industrial_complex damage = 0.1 }
					}
				}
				custom_effect_tooltip = relocate_industry_repair
			}
			custom_effect_tooltip = SOV_relocate_industry_from_moscow_tt
		}
	}

	SOV_relocate_industry_from_leningrad = {

		icon = generic_construction

		highlight_states = {
			state = 195
		}

		available = {
			195 = { #Leningrad
				is_owned_and_controlled_by = SOV
				arms_factory > 9
				industrial_complex > 2
			}
			573 = { is_owned_and_controlled_by = SOV } #Zlatoust
			582 = { is_owned_and_controlled_by = SOV } #Magnitogorsk
		}

		fire_only_once = yes

		cost = 20
		days_remove = 15

		modifier = {
			
		}

		visible = {
			has_war_with = GER
		}

		remove_effect = {
			if = {
				limit = {
					controls_state = 195
				}
				195 = { #Leningrad
					remove_building = {
						type = arms_factory
						level = 10
					}
					remove_building = {
						type = industrial_complex
						level = 3
					}
				}
	
				573 = { #Zlatoust
					add_extra_state_shared_building_slots = 5
					add_building_construction = {
						type = arms_factory
						level = 5
						instant_build = yes
					}
	
					hidden_effect = {			
						damage_building = { type = arms_factory damage = 0.3 }
					}
				}
				653 = { #Sverdlorsk
					add_extra_state_shared_building_slots = 8
					add_building_construction = {
						type = arms_factory
						level = 5
						instant_build = yes
					}
					add_building_construction = {
						type = industrial_complex
						level = 3
						instant_build = yes
					}
	
					hidden_effect = {			
						damage_building = { type = arms_factory damage = 0.2 }
						damage_building = { type = industrial_complex damage = 0.1 }
					}
				}
				custom_effect_tooltip = relocate_industry_repair
			}
			custom_effect_tooltip = SOV_relocate_industry_from_leningrad_tt
		}
	}

	SOV_relocate_industry_from_smolensk = {

		icon = generic_construction

		highlight_states = {
			state = 242
		}

		available = {
			242 = { #Smolensk
				is_owned_and_controlled_by = SOV
				industrial_complex > 1
			}
			573 = { is_owned_and_controlled_by = SOV } #Zlatoust
			582 = { is_owned_and_controlled_by = SOV } #Magnitogorsk
		}

		fire_only_once = yes

		cost = 10
		days_remove = 15

		modifier = {
			
		}

		visible = {
			has_war_with = GER
		}

		remove_effect = {
			if = {
				limit = {
					controls_state = 242
				}
				242 = { #Smolensk
					remove_building = {
						type = industrial_complex
						level = 2
					}
					remove_building = {
						type = arms_factory
						level = 1
					}
				}
				246 = { #Smolensk
					remove_building = {
						type = industrial_complex
						level = 2
					}
					remove_building = {
						type = arms_factory
						level = 1
					}
				}
				573 = { #Zlatoust
					add_extra_state_shared_building_slots = 4			
					add_building_construction = {
						type = industrial_complex
						level = 2
						instant_build = yes
					}
					add_building_construction = {
						type = arms_factory
						level = 2
						instant_build = yes
					}
	
					hidden_effect = {			
						damage_building = { type = industrial_complex damage = 0.1 }
					}
				}
				582 = { #Magnitogorsk
					add_extra_state_shared_building_slots = 2
					add_building_construction = {
						type = industrial_complex
						level = 2
						instant_build = yes
					}
				
					hidden_effect = {
						damage_building = { type = industrial_complex damage = 0.1 }
					}
				}
				custom_effect_tooltip = relocate_industry_repair
			}
			custom_effect_tooltip = SOV_relocate_industry_from_smolensk_tt
		}
	}
	SOV_relocate_industry_from_kiev = {

		icon = generic_construction

		highlight_states = {
			state = 202
		}

		available = {
			202 = { #Kiev
				is_owned_and_controlled_by = SOV
				industrial_complex > 1
			}
			652 = { is_owned_and_controlled_by = SOV } #Orenburg
			583 = { is_owned_and_controlled_by = SOV } #Kustanay
		}

		fire_only_once = yes

		cost = 15
		days_remove = 15

		modifier = {
			
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 200 # oh shit they are getting close!
				OR = {
					AND = {
						owns_state = 201
						NOT = { controls_state = 201 }
					}
					AND = {
						owns_state = 199
						NOT = { controls_state = 199 }
					}
					AND = {
						owns_state = 194
						NOT = { controls_state = 194 }
					}
					AND = {
						owns_state = 198
						NOT = { controls_state = 198 }
					}
					AND = {
						owns_state = 192
						NOT = { controls_state = 192 }
					}
					AND = {
						owns_state = 203
						NOT = { controls_state = 203 }
					}
					
				}
			}
			modifier = {
				factor = 0
				SOV_save_pp_for_manpower_trouble = yes
			}
		}

		visible = {
			has_war_with = GER
		}

		remove_effect = {
			if = {
				limit = {
					controls_state = 202
				}
				202 = { #Kiev
					remove_building = {
						type = industrial_complex
						level = 3				
					}
					remove_building = {
						type = arms_factory
						level = 4
					}
				}
				652 = { #Orenburg
					add_extra_state_shared_building_slots = 3		
					add_building_construction = {
						type = industrial_complex
						level = 3
						instant_build = yes
					}
	
					hidden_effect = {			
						damage_building = { type = industrial_complex damage = 0.1 }
					}
				}
				583 = { #Kustanay
					add_extra_state_shared_building_slots = 4
					add_building_construction = {
						type = arms_factory
						level = 4
						instant_build = yes
					}
				
					hidden_effect = {
						damage_building = { type = industrial_complex damage = 0.1 }
					}
				}
				custom_effect_tooltip = relocate_industry_repair
			}
			custom_effect_tooltip = SOV_relocate_industry_from_kiev_tt
		}
	}
	SOV_relocate_industry_from_minsk = {

		icon = generic_construction

		highlight_states = {
			state = 206
		}

		available = {
			206 = { #Minsk
				is_owned_and_controlled_by = SOV
				industrial_complex > 2
			}
			573 = { is_owned_and_controlled_by = SOV } #Zlatoust
			582 = { is_owned_and_controlled_by = SOV } #Magnitogorsk
		}

		fire_only_once = yes

		cost = 10
		days_remove = 15

		modifier = {
			
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 200 # oh shit they are getting close!
				OR = {
					AND = {
						owns_state = 204
						NOT = { controls_state = 204 }
					}
					AND = {
						owns_state = 96
						NOT = { controls_state = 96 }
					}
					AND = {
						owns_state = 95
						NOT = { controls_state = 95 }
					}
					AND = {
						owns_state = 784
						NOT = { controls_state = 784 }
					}
					
				}
			}
			modifier = {
				factor = 0
				SOV_save_pp_for_manpower_trouble = yes
			}
		}

		visible = {
			has_war_with = GER
		}

		remove_effect = {
			if = {
				limit = {
					controls_state = 206
				}
				206 = { #Minsk
					remove_building = {
						type = industrial_complex
						level = 3
						
					}
					remove_building = {
						type = arms_factory
						level = 3
					}
				}
				573 = { #Zlatoust
					add_extra_state_shared_building_slots = 3		
					add_building_construction = {
						type = arms_factory
						level = 3
						instant_build = yes
					}
	
					hidden_effect = {			
						damage_building = { type = industrial_complex damage = 0.1 }
					}
				}
				582 = { #Magnitogorsk
					add_extra_state_shared_building_slots = 3
					add_building_construction = {
						type = industrial_complex
						level = 3
						instant_build = yes
					}
				
					hidden_effect = {
						damage_building = { type = industrial_complex damage = 0.1 }
					}
				}
				custom_effect_tooltip = relocate_industry_repair
			}
			custom_effect_tooltip = SOV_relocate_industry_from_minsk_tt
		}
	}
	SOV_relocate_industry_from_kharkov = {

		icon = generic_construction

		highlight_states = {
			state = 221
		}

		available = {
			221 = { #Kharkov
				is_owned_and_controlled_by = SOV
				arms_factory > 1
			}
			651 = { is_owned_and_controlled_by = SOV } #Ufa
		}

		fire_only_once = yes

		cost = 15
		days_remove = 15

		modifier = {
			
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 200 # oh shit they are getting close!
				OR = {
					AND = {
						owns_state = 226
						NOT = { controls_state = 236 }
					}
					AND = {
						owns_state = 259
						NOT = { controls_state = 259 }
					}
					AND = {
						owns_state = 202
						NOT = { controls_state = 202 }
					}
					AND = {
						owns_state = 203
						NOT = { controls_state = 203 }
					}
					
					
				}
			}
			modifier = {
				factor = 0
				SOV_save_pp_for_manpower_trouble = yes
			}
		}

		visible = {
			has_war_with = GER
		}

		remove_effect = {
			if = {
				limit = {
					controls_state = 221
				}
				221 = { #Kharkov
					
					remove_building = {
						type = arms_factory
						level = 4
					}
				}
				651 = { #Ufa
					add_extra_state_shared_building_slots = 4				
					add_building_construction = {
						type = arms_factory
						level = 4
						instant_build = yes
					}
	
					hidden_effect = {			
						damage_building = { type = industrial_complex damage = 0.1 }
					}
				}
				
				custom_effect_tooltip = relocate_industry_repair
			}
			custom_effect_tooltip = SOV_relocate_industry_from_kharkov_tt
		}
	}
}

#Category only allowed for SOV
SOV_great_patriotic_war = {

	SOV_order_227 = {

		icon = generic_army_support

		available = {
			has_war = yes
			any_enemy_country = {
				is_major = yes
			}
			has_civil_war = no
			surrender_progress > 0.40
		}

		cost = 50
		fire_only_once = yes
		visible = {
			has_war = yes
			any_enemy_country = {
				is_major = yes
			}
			#surrender_progress > 0
		}

		days_remove = 720

		modifier = {
			army_core_defence_factor = 0.25
			army_core_attack_factor = 0.10
			mobilization_speed = 0.50
		}
		
		complete_effect = {
			if = {
				limit = {
					has_idea = generals_purged
				}
				remove_ideas = generals_purged
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				surrender_progress > 0.25
				factor = 10
			}
		}
	}

	SOV_mobilise_army = {
		icon = generic_army_support

		available = {
			has_war = yes
			any_enemy_country = {
				is_major = yes
			}
			has_civil_war = no
			surrender_progress > 0.25
		}

		cost = 20
		fire_only_once = yes
		visible = {
			has_war = yes
			any_enemy_country = {
				is_major = yes
			}
			#surrender_progress > 0
		}

		days_remove = 180

		modifier = {
			training_time_army_factor = -0.4
			mobilization_speed = 1.0
		}

	}
	
	SOV_mobilise_workers = {

		icon = generic_army_support

		available = {
			has_war = yes
			any_enemy_country = {
				is_major = yes
			}
			has_civil_war = no
			surrender_progress > 0.25
			219 = {
				is_controlled_by = SOV
			}
		}

		cost = 50
		fire_only_once = yes
		visible = {
			has_war = yes
			any_enemy_country = {
				is_major = yes
			}
			#surrender_progress > 0
		}

		days_remove = 90

		modifier = {
			industrial_capacity_factory = -0.1
		}
		
		complete_effect = {
			hidden_effect = {
				load_oob = SOV_workers
			}
			custom_effect_tooltip = SOV_militia_tt
		}

		ai_will_do = {
			factor = 1
			modifier = {
				surrender_progress > 0.25
				factor = 10
			}
		}
	}
	
	SOV_scorched_earth = {

		icon = generic_scorched_earth

		available = {
			has_war = yes
			any_enemy_country = {
				is_major = yes
			}
			surrender_progress > 0
		}

		cost = 50
		fire_only_once = yes
		visible = {
			has_war = yes
			any_enemy_country = {
				is_major = yes
			}
			surrender_progress > 0
		}

		complete_effect = {
			set_country_flag = SOV_scorched_earth
			unlock_decision_tooltip = SOV_scorched_earth_baltics
			unlock_decision_tooltip = SOV_scorched_earth_byelorussia
			unlock_decision_tooltip = SOV_scorched_earth_ukraine
			unlock_decision_tooltip = SOV_scorched_earth_stalingrad
			unlock_decision_tooltip = SOV_scorched_earth_caucasus
			unlock_decision_tooltip = SOV_scorched_earth_moscow
		}

		ai_will_do = {
			factor = 1

			modifier = {
				factor = 0
				SOV_save_pp_for_manpower_trouble = yes
			}
		}
	}
	SOV_scorched_earth_baltics = {

		icon = generic_scorched_earth

		available = {
			has_war = yes
			has_country_flag = SOV_scorched_earth
			has_equipment = {
				support_equipment > 24
			}
		}

		cost = 50
		fire_only_once = yes
		visible = {
			has_war = yes
			OR = {
				190 = { CONTROLLER = { has_war_with = SOV } }
				189 = { CONTROLLER = { has_war_with = SOV } }
				11 = { CONTROLLER = { has_war_with = SOV } }
				784 = { CONTROLLER = { has_war_with = SOV } }
				}
			has_country_flag = SOV_scorched_earth
		}

		complete_effect = {
			add_equipment_to_stockpile = {
				type = support_equipment_1
				amount = -25
			}
			if = {
				limit = {
					controls_state = 189
				}
				189 = {
					damage_building = {
						type = infrastructure
						damage = 3
					}
					remove_building = {
						type = infrastructure
						level = 1
				}

				}
			}
			if = {
				limit = {
					controls_state = 11
				}
				11 = {
					damage_building = {
						type = infrastructure
						damage = 3
					}
					remove_building = {
						type = infrastructure
						level = 1
				}
				}
			}
			if = {
				limit = {
					controls_state = 190
				}
				190 = {
					damage_building = {
						type = infrastructure
						damage = 3
					}
					remove_building = {
						type = infrastructure
						level = 1
				}
				}
			}
			if = {
				limit = {
					controls_state = 12
				}
				12 = {
					damage_building = {
						type = infrastructure
						damage = 3
					}
					remove_building = {
						type = infrastructure
						level = 1
				}
				}
			}
			if = {
				limit = {
					controls_state = 191
				}
				191 = {
					damage_building = {
						type = infrastructure
						damage = 3
					}
					remove_building = {
						type = infrastructure
						level = 1
				}
				}
			}
			if = {
				limit = {
					controls_state = 13
				}
				13 = {
					damage_building = {
						type = infrastructure
						damage = 3
					}
					remove_building = {
						type = infrastructure
						level = 1
				}
				}
			}
		}

		ai_will_do = {
			factor = 1
		}
	}
	SOV_scorched_earth_byelorussia = {

		icon = generic_scorched_earth

		available = {
			has_war = yes
			has_country_flag = SOV_scorched_earth
			has_equipment = {
				support_equipment > 49
			}
		}

		cost = 75
		fire_only_once = yes
		visible = {
			has_war = yes
			has_country_flag = SOV_scorched_earth
			OR = {
				11 = { CONTROLLER = { has_war_with = SOV } }
				97 = { CONTROLLER = { has_war_with = SOV } }
				94 = { CONTROLLER = { has_war_with = SOV } }
				}
			
		}

		complete_effect = {
			add_equipment_to_stockpile = {
				type = support_equipment_1
				amount = -50
			}
			every_state = {
				limit = {
					OR = {
						state = 784
						state = 96
						state = 206
						state = 204
						state = 95
										
					}
					is_controlled_by = SOV
				}
				damage_building = {
					type = infrastructure
					damage = 3
				}
				remove_building = {
						type = infrastructure
						level = 1
				}
			}
		}

		ai_will_do = {
			factor = 1
		}
	}
	SOV_scorched_earth_ukraine = {

		icon = generic_scorched_earth

		available = {
			has_war = yes
			has_country_flag = SOV_scorched_earth
			has_equipment = {
				support_equipment > 74
			}
		}

		cost = 75
		fire_only_once = yes
		visible = {
			has_war = yes
			has_country_flag = SOV_scorched_earth
			OR = {
				89 = { CONTROLLER = { has_war_with = SOV } }
				91 = { CONTROLLER = { has_war_with = SOV } }
				80 = { CONTROLLER = { has_war_with = SOV } }
				91 = { CONTROLLER = { has_war_with = SOV } }
				78 = { CONTROLLER = { has_war_with = SOV } }
				766 = { CONTROLLER = { has_war_with = SOV } }
				93 = { CONTROLLER = { has_war_with = SOV } }
				}
			
		}

		complete_effect = {
			add_equipment_to_stockpile = {
				type = support_equipment_1
				amount = -75
			}
			every_state = {
				limit = {
					OR = {
						state = 198
						state = 199
						state = 201
						state = 192
						state = 202
						state = 203
						state = 197
						
					}
					is_controlled_by = SOV
				}
				damage_building = {
					type = infrastructure
					damage = 3
				}
				remove_building = {
						type = infrastructure
						level = 1
				}
			}
		}

		ai_will_do = {
			factor = 1
		}
	}
	SOV_scorched_earth_caucasus = {

		icon = generic_scorched_earth

		available = {
			has_war = yes
			has_country_flag = SOV_scorched_earth
			has_equipment = {
				support_equipment > 49
			}
		}

		cost = 75
		fire_only_once = yes
		visible = {
			has_war = yes
			OR = {
				420 = { CONTROLLER = { has_war_with = SOV } }
				419 = { CONTROLLER = { has_war_with = SOV } }
				353 = { CONTROLLER = { has_war_with = SOV } }
				354 = { CONTROLLER = { has_war_with = SOV } }
				137 = { CONTROLLER = { has_war_with = SOV } }
				218 = { CONTROLLER = { has_war_with = SOV } }
				238 = { CONTROLLER = { has_war_with = SOV } }
				237 = { CONTROLLER = { has_war_with = SOV } }
				236 = { CONTROLLER = { has_war_with = SOV } }
				231 = { CONTROLLER = { has_war_with = SOV } }#sneaky QA naval invasion check
				233 = { CONTROLLER = { has_war_with = SOV } }
				234 = { CONTROLLER = { has_war_with = SOV } }
			}
			has_country_flag = SOV_scorched_earth
		}

		complete_effect = {
			add_equipment_to_stockpile = {
				type = support_equipment_1
				amount = -50
			}
			if = {
				limit = {
					229 = { is_controlled_by = SOV}
				}
				229 = {
					damage_building = {
						type = infrastructure
						damage = 3
					}
					remove_building = {
						type = infrastructure
						level = 1
				}
				}
			}
			if = {
				limit = {
					230 = { is_controlled_by = SOV}
				}
				230 = {
					damage_building = {
						type = infrastructure
						damage = 3
					}
					remove_building = {
						type = infrastructure
						level = 1
					}
				}
			}
			if = {
				limit = {
					231 = { is_controlled_by = SOV}
				}
				231 = {
					damage_building = {
						type = infrastructure
						damage = 3
					}
					remove_building = {
						type = infrastructure
						level = 1
					}
				}
			}
			if = {
				limit = {
					232 = { is_controlled_by = SOV}
				}
				232 = {
					damage_building = {
						type = infrastructure
						damage = 3
					}
					remove_building = {
						type = infrastructure
						level = 1
					}
				}
			}
			if = {
				limit = {
					233 = { is_controlled_by = SOV}
				}
				233 = {
					damage_building = {
						type = infrastructure
						damage = 3
					}
					remove_building = {
						type = infrastructure
						level = 1
					}
				}
			}
			if = {
				limit = {
					234 = { is_controlled_by = SOV}
				}
				234 = {
					damage_building = {
						type = infrastructure
						damage = 3
					}
					remove_building = {
						type = infrastructure
						level = 1
					}
				}
			}
			if = {
				limit = {
					235 = { is_controlled_by = SOV}
				}
				235 = {
					damage_building = {
						type = infrastructure
						damage = 3
					}
					remove_building = {
						type = infrastructure
						level = 1
					}
				}
			}
		}

		ai_will_do = {
			factor = 1
		}
	}
	SOV_scorched_earth_stalingrad = {

		icon = generic_scorched_earth

		available = {
			has_war = yes
			has_country_flag = SOV_scorched_earth
			has_equipment = {
				support_equipment > 49
			}
		}

		cost = 75
		fire_only_once = yes
		visible = {
			has_war = yes
			has_country_flag = SOV_scorched_earth
			OR = {
				227 = { CONTROLLER = { has_war_with = SOV } }
				228 = { CONTROLLER = { has_war_with = SOV } }
				218 = { CONTROLLER = { has_war_with = SOV } }
				245 = { CONTROLLER = { has_war_with = SOV } }
				237 = { CONTROLLER = { has_war_with = SOV } }
				236 = { CONTROLLER = { has_war_with = SOV } }
				231 = { CONTROLLER = { has_war_with = SOV } }#sneaky QA naval invasion check
				238 = { CONTROLLER = { has_war_with = SOV } }
				260 = { CONTROLLER = { has_war_with = SOV } }
				239 = { CONTROLLER = { has_war_with = SOV } }
			}
		}

		complete_effect = {
			add_equipment_to_stockpile = {
				type = support_equipment_1
				amount = -50
			}
			if = {
				limit = {
					245 = { is_controlled_by = SOV}
				}
				245 = {
					damage_building = {
						type = infrastructure
						damage = 3
					}
					remove_building = {
						type = infrastructure
						level = 1
				}
				}
			}
			if = {
				limit = {
					217 = { is_controlled_by = SOV}
				}
				217 = {
					damage_building = {
						type = infrastructure
						damage = 3
					}
					remove_building = {
						type = infrastructure
						level = 1
				}
				}
			}
			if = {
				limit = {
					218 = { is_controlled_by = SOV}
				}
				218 = {
					damage_building = {
						type = infrastructure
						damage = 3
					}
					remove_building = {
						type = infrastructure
						level = 1
				}
				}
			}
			if = {
				limit = {
					238 = { is_controlled_by = SOV}
				}
				238 = {
					damage_building = {
						type = infrastructure
						damage = 3
					}
					remove_building = {
						type = infrastructure
						level = 1
				}
				}
			}
			if = {
				limit = {
					237 = { is_controlled_by = SOV}
				}
				237 = {
					damage_building = {
						type = infrastructure
						damage = 3
					}
					remove_building = {
						type = infrastructure
						level = 1
				}
				}
			}
			if = {
				limit = {
					236 = { is_controlled_by = SOV}
				}
				236 = {
					damage_building = {
						type = infrastructure
						damage = 3
					}
					remove_building = {
						type = infrastructure
						level = 1
				}
				}
			}
			if = {
				limit = {
					265 = { is_controlled_by = SOV}
				}
				265 = {
					damage_building = {
						type = infrastructure
						damage = 3
					}
					remove_building = {
						type = infrastructure
						level = 1
				}
				}
			}
		}

		ai_will_do = {
			factor = 1
		}
	}
	SOV_scorched_earth_moscow = {

		icon = generic_scorched_earth

		available = {
			has_war = yes
			has_country_flag = SOV_scorched_earth
			has_equipment = {
				support_equipment > 49
			}
		}

		cost = 75
		fire_only_once = yes
		visible = {
			has_war = yes
			has_country_flag = SOV_scorched_earth
			OR = {
				207 = { CONTROLLER = { has_war_with = SOV } }
				210 = { CONTROLLER = { has_war_with = SOV } }
				241 = { CONTROLLER = { has_war_with = SOV } }
				193 = { CONTROLLER = { has_war_with = SOV } }
				225 = { CONTROLLER = { has_war_with = SOV } }
				240 = { CONTROLLER = { has_war_with = SOV } }
			}
		}

		complete_effect = {
			add_equipment_to_stockpile = {
				type = support_equipment_1
				amount = -50
			}
			every_state = {
				limit = {
					OR = {
						state = 220
						state = 222
						state = 224
						state = 243
						state = 205
						state = 242
						state = 246
						state = 219
					}
					is_controlled_by = SOV
				}
				damage_building = {
						type = infrastructure
						damage = 3
					}
				remove_building = {
						type = infrastructure
						level = 1
				}	
			}
			
		}

		ai_will_do = {
			factor = 1
		}
	}

}

SOV_great_patriotic_war = {

	SOV_emergency_mobilisation = {
		icon = generic_army_support
		allowed = {
			original_tag = SOV
		}
		available = {
			surrender_progress > 0.5
			651 = { 
				is_controlled_by = SOV
			}
		}
		visible = {
			has_completed_focus = SOV_war_mobilisation
		}
		
		days_remove = 60
		cost = 50
		
		modifier = {
			political_power_cost = 0.25
		}
		
		fire_only_once = yes
		
		complete_effect = {
			hidden_effect = {
				load_oob = SOV_emergency_mob
			}
			add_manpower = -100000
			custom_effect_tooltip = SOV_emergency_mob_tt
		}
	}

	SOV_emergency_tanks = {
		icon = generic_army_support
		allowed = {
			original_tag = SOV
		}
		available = {
			surrender_progress > 0.4
		}
		visible = {
			has_completed_focus = SOV_war_mobilisation
		}
		
		days_remove = 180
		cost = 50
		complete_effect = {
			add_ideas = SOV_emergency_tanks_idea
		}
		
		modifier = {
			civilian_factory_use = 10
		}
		
		fire_only_once = yes
		
		remove_effect = {
			remove_ideas = SOV_emergency_tanks_idea
		}
	}
	
	SOV_emergency_guns = {
		icon = generic_army_support
		allowed = {
			original_tag = SOV
		}
		available = {
			surrender_progress > 0.35
		}
		visible = {
			has_completed_focus = SOV_war_mobilisation
		}
		
		days_remove = 365
		cost = 50
		complete_effect = {
			add_ideas = SOV_emergency_guns_idea
		}
		
		modifier = {
			civilian_factory_use = 10
		}
		
		fire_only_once = yes

		remove_effect = {
			remove_ideas = SOV_emergency_guns_idea
		}
	}

	#217 "Stalingrad"
	SOV_hold_stalingrad = {

		icon = generic_civil_support

		allowed = {
			original_tag = SOV
		}

		#Fail trigger
		available = {
			NOT = { controls_state = 217 }
		}

		days_mission_timeout = 180

		fire_only_once = yes

		is_good = yes

		activation = {
			has_war = yes
			has_civil_war = no
			217 = {
				is_controlled_by = ROOT
				OR = {
					any_neighbor_state = {
						CONTROLLER = {
							has_war_with = ROOT
						}
						OWNER = { tag = ROOT }
					}
					NOT = { is_fully_controlled_by = ROOT }
				}
			}
		}

		#Success
		timeout_effect = {
			add_stability = 0.05
			add_war_support = 0.05
			217 = { save_event_target_as = state }			
			country_event = wtt_soviet_hold_city.1
		}
		#Fail
		complete_effect = {
			217 = { save_event_target_as = state }			
			country_event = wtt_soviet_hold_city.2
		}
	}
	
	#195 "Leningrad"
	SOV_hold_leningrad = {

		icon = generic_civil_support

		allowed = {
			original_tag = SOV
		}

		#Fail trigger
		available = {
			NOT = { controls_state = 195 }
		}

		days_mission_timeout = 180

		fire_only_once = yes

		is_good = yes

		activation = {
			has_war = yes
			has_civil_war = no
			195 = {
				is_controlled_by = ROOT
				OR = {
					any_neighbor_state = {
						CONTROLLER = {
							has_war_with = ROOT
						}
						OWNER = { tag = ROOT }
					}
					NOT = { is_fully_controlled_by = ROOT }
				}
			}
		}

		#Success
		timeout_effect = {
			add_stability = 0.05
			add_war_support = 0.05
			195 = { save_event_target_as = state }
			country_event = wtt_soviet_hold_city.3
		}
		#Fail
		complete_effect = {
			195 = { save_event_target_as = state }
			country_event = wtt_soviet_hold_city.4
		}
	}

	#219 "Moscow"
	SOV_hold_moscow = {

		icon = generic_civil_support

		allowed = {
			original_tag = SOV
		}

		#Fail trigger
		available = {
			NOT = { controls_state = 219 }
		}

		days_mission_timeout = 180

		fire_only_once = yes

		is_good = yes

		activation = {
			has_war = yes
			has_civil_war = no
			219 = {
				is_controlled_by = ROOT
				OR = {
					any_neighbor_state = {
						CONTROLLER = {
							has_war_with = ROOT
						}
						OWNER = { tag = ROOT }
					}
					NOT = { is_fully_controlled_by = ROOT }
				}
			}
		}

		#Success
		timeout_effect = {
			add_stability = 0.05
			add_war_support = 0.05
			219 = { save_event_target_as = state }
			country_event = wtt_soviet_hold_city.5
		}
		#Fail
		complete_effect = {
			219 = { save_event_target_as = state }
			country_event = wtt_soviet_hold_city.6
		}
	}
}

operations = {

	SOV_probe_japan = {
		icon = border_war
		allowed = {
			original_tag = SOV
		}

		available = {
			has_war = no
			date > 1940.1.1
		}

		visible = {
		}

		fire_only_once = yes

		cost = 50
		
		days_remove = 180
		
		complete_effect = {
			JAP = {
				activate_mission = SOV_border_war_warning_JAP
			}
		}
		
		remove_effect = {
			TIB = {
				remove_ideas = neutrality_idea2
			}
			create_wargoal = {
				target = TIB
				type = annex_everything
			}
		}
	}
	
	SOV_border_war_SOV = {

		icon = border_war

		allowed = { always = no }

		available = {
			any_other_country = {
				original_tag = TIB
				has_government = communism
				has_war = no
			}
		}

		days_mission_timeout = 90

		fire_only_once = yes

		is_good = no
		
		complete_effect = {
			country_event = soviet.1112
		}
		
	}

	SOV_winter_off = {

		icon = generic_operation

		allowed = {
			original_tag = SOV
		}

		available = {
			OR = {
				AND = {
					date > 1939.11.1
					date < 1940.1.1
				}
				AND = {
					date > 1940.11.1
					date < 1941.1.1
				}
				AND = {
					date > 1941.11.1
					date < 1942.1.1
				}
				AND = {
					date > 1942.11.1
					date < 1943.1.1
				}
				AND = {
					date > 1943.11.1
					date < 1944.1.1
				}
				AND = {
					date > 1944.11.1
					date < 1945.1.1
				}
				AND = {
					date > 1945.11.1
					date < 1946.1.1
				}
			}
			surrender_progress > 0
		}

		cost = 0

		days_re_enable = 250

		visible = {
			tag = SOV
			has_war_with = GER
			NOT = { has_idea = SOV_winter_off }
			NOT = { has_idea = SOV_summer_off }
		}
		
		days_remove = 14

		modifier = {
			acclimatization_cold_climate_gain_factor = 2.0
			max_planning = 0.1
			planning_speed = 0.25
		}

		remove_effect = {
			add_timed_idea = {
				idea = SOV_winter_off
				days = 90
			}
		}

	}
	
	SOV_summer_off = {

		icon = generic_operation

		allowed = {
			original_tag = SOV
		}

		available = {
			OR = {
				AND = {
					date > 1942.6.1
					date < 1942.8.1
				}
				AND = {
					date > 1943.6.1
					date < 1943.8.1
				}
				AND = {
					date > 1944.6.1
					date < 1944.8.1
				}
				AND = {
					date > 1945.6.1
					date < 1945.8.1
				}
				AND = {
					date > 1946.6.1
					date < 1946.8.1
				}
			}
			surrender_progress < 0.05
		}

		cost = 0

		days_re_enable = 250

		visible = {
			tag = SOV
			has_war_with = GER
			NOT = { has_idea = SOV_summer_off }
			NOT = { has_idea = generals_purged }
			NOT = { has_idea = SOV_invade_germany_idea }
		}
		
		days_remove = 14

		modifier = {
			max_planning = 0.1
			planning_speed = 0.25
		}

		remove_effect = {
			add_timed_idea = {
				idea = SOV_summer_off
				days = 60
			}
		}

	}

	SOV_molotov_line_expansion = {

		icon = generic_operation

		allowed = {
			always = no
		}
		
		available = {
			has_war_with = GER
		}

		days_mission_timeout = 360
		fire_only_once = yes

		activation = {

		}

		is_good = yes

		complete_effect = {
		}

		timeout_effect = {
			189 = {
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 6314
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 9499
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 3337
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 6360
				}
			}
			11 = {
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 3272
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 6281
				}
			}
			97 = {
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 400
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 11357
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 11274
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 11329
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 290
				}
			}
			94 = {
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 3392
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 6546
				}
			}
			93 = {
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 11441
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 422
				}
			}
			91 = {
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 536
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 9468
				}
			}
			89 = {
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 6431
				}
			}
			activate_mission = SOV_molotov_line_expansion2
		}

		ai_will_do = {
			factor = 1
		}
	}
	
	SOV_molotov_line_expansion2 = {

		icon = generic_operation

		allowed = {
			always = no
		}
		
		available = {
			has_war_with = GER
		}

		days_mission_timeout = 180
		fire_only_once = yes

		activation = {

		}

		is_good = yes

		complete_effect = {
		}

		timeout_effect = {
			189 = {
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 6314
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 9499
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 3337
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 6360
				}
			}
			11 = {
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 3272
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 6281
				}
			}
			97 = {
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 400
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 11357
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 11274
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 11329
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 290
				}
			}
			94 = {
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 3392
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 6546
				}
			}
			93 = {
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 11441
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 422
				}
			}
			91 = {
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 536
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 9468
				}
			}
			89 = {
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 6431
				}
			}
			activate_mission = SOV_molotov_line_expansion3
		}

		ai_will_do = {
			factor = 1
		}
	}
	
	SOV_molotov_line_expansion3 = {

		icon = generic_operation

		allowed = {
			always = no
		}
		
		available = {
			has_war_with = GER
		}

		days_mission_timeout = 180
		fire_only_once = yes

		activation = {

		}

		is_good = yes

		complete_effect = {
		}

		timeout_effect = {
			189 = {
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 6314
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 9499
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 3337
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 6360
				}
			}
			11 = {
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 3272
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 6281
				}
			}
			97 = {
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 400
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 11357
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 11274
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 11329
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 290
				}
			}
			94 = {
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 3392
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 6546
				}
			}
			93 = {
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 11441
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 422
				}
			}
			91 = {
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 536
				}
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 9468
				}
			}
			89 = {
				add_building_construction = {
					type = bunker
					level = 1
					instant_build = yes
					province = 6431
				}
			}
		}

		ai_will_do = {
			factor = 1
		}
	}
	
	SOV_finish_stalin_line = {

		icon = generic_operation

		allowed = {
			original_tag = SOV
		}

		available = {
			date > 1937.1.1
			NOT = { has_completed_focus = SOV_dismantle_stalin_line }
		}

		cost = 0
		fire_only_once = yes
		visible = {
			tag = SOV
			has_war = no
		}
		
		days_remove = 180

		modifier = {
			civilian_factory_use = 5
			production_speed_bunker_factor = -0.5
		}

		remove_effect = {
			192 = {
				add_building_construction = {
					type = bunker
					level = 4
					instant_build = yes
					province = 11670
				}
			}
			198 = {
				add_building_construction = {
					type = bunker
					level = 4
					instant_build = yes
					province = 6455
				}
			}
			199 = {
				add_building_construction = {
					type = bunker
					level = 4
					instant_build = yes
					province = 3457
				}
			}
			204 = {
				add_building_construction = {
					type = bunker
					level = 4
					instant_build = yes
					province = 11313
				}
			}
			209 = {
				add_building_construction = {
					type = bunker
					level = 4
					instant_build = yes
					province = 11392
				}
				add_building_construction = {
					type = bunker
					level = 4
					instant_build = yes
					province = 6324
				}
			}
			210 = {
				add_building_construction = {
					type = bunker
					level = 4
					instant_build = yes
					province = 11259
				}
				add_building_construction = {
					type = bunker
					level = 4
					instant_build = yes
					province = 6242
				}
			}
			set_country_flag = SOV_stalin_finished
		}

		ai_will_do = {
			factor = 1
			modifier = {
				MAN = {
					is_ai = no
				}
				factor = 0 #we're mean but not that mean
			}
			modifier = {
				threat < 0.25
				factor = 0
			}
		}
	}

}

political_actions = {

	demand_tribute_from_new_communist_china = {

		icon = generic_civil_support

		allowed = {
			tag = SOV
		}

		icon = generic_political_actions

		available = {
			
		}

		ai_will_do = {
			base = 0
			modifier = {
				add = 150
					#Has somewhat won against CHI and JAP
				count_triggers = {
					amount = 10
					595 = { is_controlled_by = FROM }
					596 = { is_controlled_by = FROM }
					597 = { is_controlled_by = FROM }
					598 = { is_controlled_by = FROM }
					600 = { is_controlled_by = FROM }
					601 = { is_controlled_by = FROM }
					602 = { is_controlled_by = FROM }
					603 = { is_controlled_by = FROM }
					605 = { is_controlled_by = FROM }
					606 = { is_controlled_by = FROM }
					607 = { is_controlled_by = FROM }
					608 = { is_controlled_by = FROM }
					613 = { is_controlled_by = FROM }
					614 = { is_controlled_by = FROM }
					620 = { is_controlled_by = FROM }				
				}
			}

		}

		cost = 10

		visible = {
			has_government = communism
			FROM = {
				has_country_flag = WTT_support_from_soviet
				NOT = { has_war_with = ROOT }
				NOT = { is_subject_of = ROOT }
				NOT = { has_idea = PRC_soviet_tribute_6 }
			}
		}

		targets = { CHI PRC GXC YUN SHX XSM SIK }
		targets_dynamic = yes

		target_trigger = {
			FROM = { 
				tag = event_target:WTT_communist_china
				has_country_flag = WTT_support_from_soviet 
			}
		}

		fire_only_once = no

		days_re_enable = 180

		complete_effect = {
			FROM = {
				country_event = { id = wtt_warlord_vs_prc.21 }
				custom_effect_tooltip = if_they_accept
				effect_tooltip = {
					PRC_soviet_tribute_level_up = yes	
				}
			}
		}
	}

	demand_full_integration = {

		icon = generic_civil_support

		allowed = {
			tag = SOV			
		}

		icon = generic_political_actions

		available = {
			FROM = { has_soviet_tribute = yes }
		}

		cost = WTT_communist_china_integration_cost?300

		visible = {
			has_government = communism
			FROM = { has_country_flag = WTT_support_from_soviet }
		}

		targets = { CHI PRC GXC YUN SHX XSM SIK }
		targets_dynamic = yes

		target_trigger = {
			FROM = { has_country_flag = WTT_support_from_soviet }
		}

		ai_will_do = {
			base = 0
			modifier = {
				add = 100
				#Has won against CHI and JAP
				595 = { is_controlled_by = FROM }
				596 = { is_controlled_by = FROM }
				597 = { is_controlled_by = FROM }
				598 = { is_controlled_by = FROM }
				600 = { is_controlled_by = FROM }
				601 = { is_controlled_by = FROM }
				602 = { is_controlled_by = FROM }
				603 = { is_controlled_by = FROM }
				605 = { is_controlled_by = FROM }
				606 = { is_controlled_by = FROM }
				607 = { is_controlled_by = FROM }
				608 = { is_controlled_by = FROM }
				613 = { is_controlled_by = FROM }
				614 = { is_controlled_by = FROM }
				620 = { is_controlled_by = FROM }
			}
			modifier = {
				add = 50
				FROM = {
					check_variable = { WTT_communist_china_integration_cost < 200 }
				}
			}
			modifier = {
				add = 50
				FROM = {
					check_variable = { WTT_communist_china_integration_cost < 150 }
				}
			}
			modifier = {
				add = 50
				FROM = {
					check_variable = { WTT_communist_china_integration_cost < 100 }
				}
			}
		}

		fire_only_once = yes

		complete_effect = {
			FROM = { country_event = { id = wtt_warlord_vs_prc.31 } }
		}
	}	

}